<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><a name="line-2"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Module      : Streamly.Internal.Data.Sink</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Copyright   : (c) 2019 Composewell Technologies</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- License     : BSD3</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- Maintainer  : streamly@composewell.com</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Stability   : experimental</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Portability : GHC</span><span>
</span><a name="line-9"></a><span class="hs-comment">--</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- The 'Sink' type is a just a special case of 'Fold' and we can do without</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- it. However, in some cases 'Sink' is a simpler type and may provide better</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- performance than 'Fold' because it does not maintain any state. Folds can</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- be used for both pure and monadic computations. Sinks are not applicable to</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- pure computations.</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Streamly.Internal.Data.Sink</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-19"></a><span>      </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-comment">-- * Upgrading</span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#toFold"><span class="hs-identifier hs-var">toFold</span></a><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-comment">-- * Composing Sinks</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-comment">-- ** Distribute</span><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#tee"><span class="hs-identifier hs-var">tee</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#distribute"><span class="hs-identifier hs-var">distribute</span></a><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-comment">-- ** Demultiplex</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#demux"><span class="hs-identifier hs-var">demux</span></a><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-comment">-- ** Unzip</span><span>
</span><a name="line-33"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#unzipM"><span class="hs-identifier hs-var">unzipM</span></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#unzip"><span class="hs-identifier hs-var">unzip</span></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span>    </span><span class="hs-comment">-- -- ** Group</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-comment">-- , grouped</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-comment">-- -- ** Nest</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-comment">-- , concatFold</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-comment">-- -- * Comonad</span><span>
</span><a name="line-43"></a><span>    </span><span class="hs-comment">-- , duplicate</span><span>
</span><a name="line-44"></a><span>
</span><a name="line-45"></a><span>    </span><span class="hs-comment">-- * Input Transformation</span><span>
</span><a name="line-46"></a><span>    </span><span class="hs-comment">-- | These are contravariant operations i.e. they apply on the input of the</span><span>
</span><a name="line-47"></a><span>    </span><span class="hs-comment">-- 'Sink', for this reason they are prefixed with 'l' for 'left'.</span><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#lmap"><span class="hs-identifier hs-var">lmap</span></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#lmapM"><span class="hs-identifier hs-var">lmapM</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#lfilter"><span class="hs-identifier hs-var">lfilter</span></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#lfilterM"><span class="hs-identifier hs-var">lfilterM</span></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-comment">-- * Sinks</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#drain"><span class="hs-identifier hs-var">drain</span></a><span>
</span><a name="line-55"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Streamly.Internal.Data.Sink.html#drainM"><span class="hs-identifier hs-var">drainM</span></a><span>
</span><a name="line-56"></a><span>    </span><span class="hs-comment">-- , drainN</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-comment">-- , drainWhile</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">where</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">when</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">void</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-64"></a><span>       </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">filter</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">drop</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">take</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">takeWhile</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldr</span><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span>               </span><span class="hs-identifier hs-var">foldl</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">map</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sequence</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">all</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">any</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">product</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">elem</span><span class="hs-special">,</span><span>
</span><a name="line-66"></a><span>               </span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maximum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">minimum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">head</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">last</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">tail</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">length</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">null</span><span class="hs-special">,</span><span>
</span><a name="line-67"></a><span>               </span><span class="hs-identifier hs-var">reverse</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">iterate</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">init</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">and</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">or</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">lookup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldr1</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">!!</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>               </span><span class="hs-identifier hs-var">scanl</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">scanl1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">replicate</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mconcat</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unzip</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><a href="Streamly.Internal.Data.Fold.Types.html"><span class="hs-identifier">Streamly.Internal.Data.Fold.Types</span></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Fold.Types.html#Fold"><span class="hs-identifier hs-type">Fold</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html"><span class="hs-identifier">Streamly.Internal.Data.Sink.Types</span></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- Conversion</span><span>
</span><a name="line-77"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-comment">-- | Convert a 'Sink' to a 'Fold'. When you want to compose sinks and folds</span><span>
</span><a name="line-80"></a><span class="hs-comment">-- together, upgrade a sink to a fold before composing.</span><span>
</span><a name="line-81"></a><span class="hs-identifier">toFold</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109183"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109183"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109184"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Fold.Types.html#Fold"><span class="hs-identifier hs-type">Fold</span></a><span> </span><a href="#local-6989586621679109183"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109184"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><a name="toFold"><a href="Streamly.Internal.Data.Sink.html#toFold"><span class="hs-identifier">toFold</span></a></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109185"><a href="#local-6989586621679109185"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Fold.Types.html#Fold"><span class="hs-identifier hs-var">Fold</span></a><span> </span><a href="#local-6989586621679109187"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679109186"><span class="hs-identifier hs-var">begin</span></a><span> </span><a href="#local-6989586621679109188"><span class="hs-identifier hs-var">done</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>    </span><a name="local-6989586621679109186"><a href="#local-6989586621679109186"><span class="hs-identifier">begin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>    </span><a name="local-6989586621679109187"><a href="#local-6989586621679109187"><span class="hs-identifier">step</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679109185"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-86"></a><span>    </span><a name="local-6989586621679109188"><a href="#local-6989586621679109188"><span class="hs-identifier">done</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- Composing with sinks</span><span>
</span><a name="line-90"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-91"></a><span>
</span><a name="line-92"></a><span class="hs-comment">-- | Distribute one copy each of the input to both the sinks.</span><span>
</span><a name="line-93"></a><span class="hs-comment">--</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-95"></a><span class="hs-comment">--                 |-------Sink m a</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- ---stream m a---|</span><span>
</span><a name="line-97"></a><span class="hs-comment">--                 |-------Sink m a</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- &gt; let pr x = Sink.drainM (putStrLn . ((x ++ &quot; &quot;) ++) . show)</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- &gt; sink (Sink.tee (pr \&quot;L&quot;) (pr \&quot;R&quot;)) (S.enumerateFromTo 1 2)</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- L 1</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- R 1</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- L 2</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- R 2</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-107"></a><span class="hs-comment">--</span><span>
</span><a name="line-108"></a><span class="hs-identifier">tee</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109181"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109181"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109182"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109181"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109182"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109181"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109182"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-109"></a><a name="tee"><a href="Streamly.Internal.Data.Sink.html#tee"><span class="hs-identifier">tee</span></a></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109189"><a href="#local-6989586621679109189"><span class="hs-identifier">fL</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109190"><a href="#local-6989586621679109190"><span class="hs-identifier">fR</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679109191"><a href="#local-6989586621679109191"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109189"><span class="hs-identifier hs-var">fL</span></a><span> </span><a href="#local-6989586621679109191"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679109190"><span class="hs-identifier hs-var">fR</span></a><span> </span><a href="#local-6989586621679109191"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span class="hs-comment">-- | Distribute copies of the input to all the sinks in a container.</span><span>
</span><a name="line-112"></a><span class="hs-comment">--</span><span>
</span><a name="line-113"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-114"></a><span class="hs-comment">--                 |-------Sink m a</span><span>
</span><a name="line-115"></a><span class="hs-comment">-- ---stream m a---|</span><span>
</span><a name="line-116"></a><span class="hs-comment">--                 |-------Sink m a</span><span>
</span><a name="line-117"></a><span class="hs-comment">--                 |</span><span>
</span><a name="line-118"></a><span class="hs-comment">--                       ...</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-120"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- &gt; let pr x = Sink.drainM (putStrLn . ((x ++ &quot; &quot;) ++) . show)</span><span>
</span><a name="line-122"></a><span class="hs-comment">-- &gt; sink (Sink.distribute [(pr \&quot;L&quot;), (pr \&quot;R&quot;)]) (S.enumerateFromTo 1 2)</span><span>
</span><a name="line-123"></a><span class="hs-comment">-- L 1</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- R 1</span><span>
</span><a name="line-125"></a><span class="hs-comment">-- L 2</span><span>
</span><a name="line-126"></a><span class="hs-comment">-- R 2</span><span>
</span><a name="line-127"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-128"></a><span class="hs-comment">--</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- This is the consumer side dual of the producer side 'sequence_' operation.</span><span>
</span><a name="line-130"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">distribute</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-131"></a><span class="hs-identifier">distribute</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109179"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109179"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109180"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109179"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109180"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-132"></a><a name="distribute"><a href="Streamly.Internal.Data.Sink.html#distribute"><span class="hs-identifier">distribute</span></a></a><span> </span><a name="local-6989586621679109192"><a href="#local-6989586621679109192"><span class="hs-identifier">ss</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679109193"><a href="#local-6989586621679109193"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Prelude.mapM_</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109194"><a href="#local-6989586621679109194"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109194"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679109193"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679109192"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-comment">-- | Demultiplex to multiple consumers without collecting the results. Useful</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- to run different effectful computations depending on the value of the stream</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- elements, for example handling network packets of different types using</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- different handlers.</span><span>
</span><a name="line-138"></a><span class="hs-comment">--</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-140"></a><span class="hs-comment">--</span><span>
</span><a name="line-141"></a><span class="hs-comment">--                             |-------Sink m a</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- -----stream m a-----Map-----|</span><span>
</span><a name="line-143"></a><span class="hs-comment">--                             |-------Sink m a</span><span>
</span><a name="line-144"></a><span class="hs-comment">--                             |</span><span>
</span><a name="line-145"></a><span class="hs-comment">--                                       ...</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-147"></a><span class="hs-comment">--</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- &gt; let pr x = Sink.drainM (putStrLn . ((x ++ &quot; &quot;) ++) . show)</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- &gt; let table = Data.Map.fromList [(1, pr \&quot;One&quot;), (2, pr \&quot;Two&quot;)]</span><span>
</span><a name="line-151"></a><span class="hs-comment">--   in Sink.sink (Sink.demux id table) (S.enumerateFromTo 1 100)</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- One 1</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- Two 2</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-155"></a><span class="hs-comment">{-
demux :: (Monad m, Ord k) =&gt; (a -&gt; k) -&gt; Map k (Sink m a) -&gt; Sink m a
demux f kv = Sink step

    where

    step a =
        -- XXX should we raise an exception in Nothing case?
        -- Ideally we should enforce that it is a total map over k so that look
        -- up never fails
        case Map.lookup (f a) kv of
            Nothing -&gt; return ()
            Just (Sink g) -&gt; g a
-}</span><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span class="hs-identifier">demux</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109176"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679109177"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="#local-6989586621679109177"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109176"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109178"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109176"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109178"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679109177"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><a name="demux"><a href="Streamly.Internal.Data.Sink.html#demux"><span class="hs-identifier">demux</span></a></a><span> </span><a name="local-6989586621679109195"><a href="#local-6989586621679109195"><span class="hs-identifier">kv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a href="#local-6989586621679109196"><span class="hs-identifier hs-var">step</span></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-174"></a><span>
</span><a name="line-175"></a><span>    </span><a name="local-6989586621679109196"><a href="#local-6989586621679109196"><span class="hs-identifier">step</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679109197"><a href="#local-6989586621679109197"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679109198"><a href="#local-6989586621679109198"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-176"></a><span>        </span><span class="hs-comment">-- XXX should we raise an exception in Nothing case?</span><span>
</span><a name="line-177"></a><span>        </span><span class="hs-comment">-- Ideally we should enforce that it is a total map over k so that look</span><span>
</span><a name="line-178"></a><span>        </span><span class="hs-comment">-- up never fails</span><span>
</span><a name="line-179"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679109198"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679109195"><span class="hs-identifier hs-var">kv</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-180"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109199"><a href="#local-6989586621679109199"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109199"><span class="hs-identifier hs-var">g</span></a><span> </span><a href="#local-6989586621679109197"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">-- | Split elements in the input stream into two parts using a monadic unzip</span><span>
</span><a name="line-184"></a><span class="hs-comment">-- function, direct each part to a different sink.</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-187"></a><span class="hs-comment">--</span><span>
</span><a name="line-188"></a><span class="hs-comment">--                           |-------Sink m b</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- -----Stream m a----(b,c)--|</span><span>
</span><a name="line-190"></a><span class="hs-comment">--                           |-------Sink m c</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- &gt; let pr x = Sink.drainM (putStrLn . ((x ++ &quot; &quot;) ++) . show)</span><span>
</span><a name="line-194"></a><span class="hs-comment">--   in Sink.sink (Sink.unzip return (pr \&quot;L&quot;) (pr \&quot;R&quot;)) (S.yield (1,2))</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- L 1</span><span>
</span><a name="line-196"></a><span class="hs-comment">-- R 2</span><span>
</span><a name="line-197"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-198"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unzipM</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-199"></a><span class="hs-identifier">unzipM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109172"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109173"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109172"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109174"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><a href="#local-6989586621679109175"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109172"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109174"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109172"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109175"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109172"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109173"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-200"></a><a name="unzipM"><a href="Streamly.Internal.Data.Sink.html#unzipM"><span class="hs-identifier">unzipM</span></a></a><span> </span><a name="local-6989586621679109200"><a href="#local-6989586621679109200"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109201"><a href="#local-6989586621679109201"><span class="hs-identifier">stepB</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109202"><a href="#local-6989586621679109202"><span class="hs-identifier">stepC</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-201"></a><span>    </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679109203"><a href="#local-6989586621679109203"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109200"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679109203"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679109204"><a href="#local-6989586621679109204"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><a name="local-6989586621679109205"><a href="#local-6989586621679109205"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109201"><span class="hs-identifier hs-var">stepB</span></a><span> </span><a href="#local-6989586621679109204"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679109202"><span class="hs-identifier hs-var">stepC</span></a><span> </span><a href="#local-6989586621679109205"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-comment">-- | Same as 'unzipM' but with a pure unzip function.</span><span>
</span><a name="line-204"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">unzip</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-205"></a><span class="hs-identifier">unzip</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109168"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109169"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109170"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><a href="#local-6989586621679109171"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109168"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109170"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109168"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109171"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109168"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109169"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-206"></a><a name="unzip"><a href="Streamly.Internal.Data.Sink.html#unzip"><span class="hs-identifier">unzip</span></a></a><span> </span><a name="local-6989586621679109206"><a href="#local-6989586621679109206"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.html#unzipM"><span class="hs-identifier hs-var">unzipM</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679109206"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- Input transformation</span><span>
</span><a name="line-210"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span class="hs-comment">-- | Map a pure function on the input of a 'Sink'.</span><span>
</span><a name="line-213"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">lmap</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-214"></a><span class="hs-identifier">lmap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109165"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109166"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109167"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109166"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109167"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109165"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-215"></a><a name="lmap"><a href="Streamly.Internal.Data.Sink.html#lmap"><span class="hs-identifier">lmap</span></a></a><span> </span><a name="local-6989586621679109207"><a href="#local-6989586621679109207"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109208"><a href="#local-6989586621679109208"><span class="hs-identifier">step</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109208"><span class="hs-identifier hs-var">step</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679109207"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-comment">-- | Map a monadic function on the input of a 'Sink'.</span><span>
</span><a name="line-218"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">lmapM</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-219"></a><span class="hs-identifier">lmapM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109162"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109163"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109162"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109164"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109162"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109164"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109162"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109163"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-220"></a><a name="lmapM"><a href="Streamly.Internal.Data.Sink.html#lmapM"><span class="hs-identifier">lmapM</span></a></a><span> </span><a name="local-6989586621679109209"><a href="#local-6989586621679109209"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109210"><a href="#local-6989586621679109210"><span class="hs-identifier">step</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679109211"><a href="#local-6989586621679109211"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109209"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679109211"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679109210"><span class="hs-identifier hs-var">step</span></a><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">-- | Filter the input of a 'Sink' using a pure predicate function.</span><span>
</span><a name="line-223"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">lfilter</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-224"></a><span class="hs-identifier">lfilter</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109160"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109161"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109160"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109161"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109160"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109161"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-225"></a><a name="lfilter"><a href="Streamly.Internal.Data.Sink.html#lfilter"><span class="hs-identifier">lfilter</span></a></a><span> </span><a name="local-6989586621679109212"><a href="#local-6989586621679109212"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109213"><a href="#local-6989586621679109213"><span class="hs-identifier">step</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679109214"><a href="#local-6989586621679109214"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109212"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679109214"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679109213"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679109214"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- | Filter the input of a 'Sink' using a monadic predicate function.</span><span>
</span><a name="line-228"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">lfilterM</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-229"></a><span class="hs-identifier">lfilterM</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109158"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109159"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109158"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109158"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109159"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109158"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109159"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-230"></a><a name="lfilterM"><a href="Streamly.Internal.Data.Sink.html#lfilterM"><span class="hs-identifier">lfilterM</span></a></a><span> </span><a name="local-6989586621679109215"><a href="#local-6989586621679109215"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><a name="local-6989586621679109216"><a href="#local-6989586621679109216"><span class="hs-identifier">step</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679109217"><a href="#local-6989586621679109217"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109215"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679109217"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679109218"><a href="#local-6989586621679109218"><span class="hs-identifier">use</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><a href="#local-6989586621679109218"><span class="hs-identifier hs-var">use</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679109216"><span class="hs-identifier hs-var">step</span></a><span> </span><a href="#local-6989586621679109217"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- Sinks</span><span>
</span><a name="line-234"></a><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-comment">-- | Drain all input, running the effects and discarding the results.</span><span>
</span><a name="line-237"></a><span class="hs-identifier">drain</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109156"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109156"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109157"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-238"></a><a name="drain"><a href="Streamly.Internal.Data.Sink.html#drain"><span class="hs-identifier">drain</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>
</span><a name="line-240"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- &gt; drainM f = lmapM f drain</span><span>
</span><a name="line-242"></a><span class="hs-comment">--</span><span>
</span><a name="line-243"></a><span class="hs-comment">-- Drain all input after passing it through a monadic function.</span><span>
</span><a name="line-244"></a><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="hs-pragma">drainM</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-245"></a><span class="hs-identifier">drainM</span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679109153"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679109154"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679109153"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109155"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-type">Sink</span></a><span> </span><a href="#local-6989586621679109153"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679109154"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-246"></a><a name="drainM"><a href="Streamly.Internal.Data.Sink.html#drainM"><span class="hs-identifier">drainM</span></a></a><span> </span><a name="local-6989586621679109219"><a href="#local-6989586621679109219"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Streamly.Internal.Data.Sink.Types.html#Sink"><span class="hs-identifier hs-var">Sink</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679109219"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-247"></a></pre></body></html>